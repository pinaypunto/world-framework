(function(){var App,Atomic,World,guid,_ref,_ref1,_ref10,_ref11,_ref12,_ref13,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};World={},World.Event=function(){var inform,listen,_listeners;return _listeners={},listen=function(eventName,callback){return _listeners[eventName]=_listeners[eventName]||[],_listeners[eventName].push(callback)},inform=function(eventName,data){var listener,_i,_len,_ref,_results;if(!_listeners[namespace])return!1;for(_ref=_listeners[namespace],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)listener=_ref[_i],_results.push(listener.call(listener,data));return _results},{listen:listen,inform:inform,listeners:function(){return _listeners}}}(),World.Item=function(){function Item(attributes,children){var child,_i,_len,_ref;for(this.attributes=null!=attributes?attributes:{},this.children=null!=children?children:[],this.uid=guid(),this.namespace=this.constructor.name,this.listeners={},_ref=this.children,_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],child.parent=this}return Item.prototype.setAttributes=function(attributes){return this.attributes=attributes,this},Item.prototype.mixAttributes=function(attributes){var key,value,_results;_results=[];for(key in attributes)value=attributes[key],_results.push(this.attributes[key]=value);return _results},Item.prototype.appendChilds=function(children){var child,_i,_len;for(_i=0,_len=children.length;_len>_i;_i++)child=children[_i],child.parent=this;return this.children=this.children.concat(children)},Item.prototype.bubble=function(eventName,data,emmiter){var result;return null==data&&(data={}),null==emmiter&&(emmiter=this),this.parent&&(result=this.parent.trigger(eventName,data,emmiter),this.preventBubbling!==!0&&result!==!1)?this.parent.bubble(eventName,data,emmiter):void 0},Item.prototype.tunnel=function(eventName,data,emmiter){var child,result,_i,_len,_ref,_results;for(null==data&&(data={}),null==emmiter&&(emmiter=this),data._emmiter=data._emmiter||this,_ref=this.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],result=child.trigger(eventName,data),child.preventTunneling!==!0&&result!==!1?_results.push(child.tunnel(eventName,data,namespace,emmiter)):_results.push(void 0);return _results},Item.prototype.listen=function(eventName,callback){return this.listeners[eventName]=this.listeners[eventName]||[],this.listeners[eventName].push(callback)},Item.prototype.unlisten=function(eventName,callback){var index;return this.listeners[eventName]?(index=this.listeners[eventName].indexOf(callback),index>-1?this.listeners[eventName].splice(index,1):void 0):!1},Item.prototype.trigger=function(eventName,data,emmiter){var callback,_i,_len,_ref,_results;if(this.listeners[eventName]){for(_ref=this.listeners[eventName],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)callback=_ref[_i],_results.push(callback.call(callback,data,emmiter));return _results}},Item}(),guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r,v;return r=16*Math.random()|0,v="x"===c?r:3&r|8,v.toString(16)}).toUpperCase()},Atomic={},Atomic.Class=function(_super){function Class(attributes,children){this.attributes=null!=attributes?attributes:{},this.children=null!=children?children:[],Class.__super__.constructor.apply(this,arguments),this.constructor.template&&this.constructor.autorender!==!1&&this.__createElementNode()}return __extends(Class,_super),Class.prototype.render=function(container,force){var child,default_children_container,_i,_len,_ref,_results;if(this.container=container,null==force&&(force=!1),(this.constructor.autorender!==!1||force)&&(this.el||this.__createElementNode(),this.container.append(this.el),this.children.length>0)){for(default_children_container=this.__getDefaultContainer(),_ref=this.children,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],child.attributes.container?_results.push(child.render(this.__getChildContainer__(child.attributes.container))):_results.push(child.render(default_children_container));return _results}},Class.prototype.__createElementNode=function(){var callback,el,evt,parts,_ref,_results;if(this.el=$$(templayed(this.constructor.template)(this.attributes)),this.events&&this.el){_ref=this.events,_results=[];for(evt in _ref)callback=_ref[evt],parts=evt.split(" "),el=1===parts.length?this.el:this.el.find(parts.slice(1).join(" ")),_results.push(el.on(evt,this[callback]));return _results}},Class.prototype.__getDefaultContainer=function(){var container;return container=this.el.find("[data-children-container]"),container.length?container:this.el},Class.prototype.__getChildContainer__=function(child_container){return this.el.find("[data-children-container="+child_container+"]")},Class}(World.Item),Atomic.Atom=function(_super){function Atom(){return _ref=Atom.__super__.constructor.apply(this,arguments)}return __extends(Atom,_super),Atom.prototype.preventTunneling=!0,Atom}(Atomic.Class),Atomic.Molecule=function(_super){function Molecule(){return _ref1=Molecule.__super__.constructor.apply(this,arguments)}return __extends(Molecule,_super),Molecule}(Atomic.Class),Atomic.Organism=function(_super){function Organism(){return _ref2=Organism.__super__.constructor.apply(this,arguments)}return __extends(Organism,_super),Organism}(Atomic.Class),Atomic.Template=function(_super){function Template(){return _ref3=Template.__super__.constructor.apply(this,arguments)}return __extends(Template,_super),Template.prototype.preventBubbling=!0,Template}(Atomic.Class),Atomic.Dom=Atomic["@@"]=function(){return function(){return console.log("Go!")}}(),Atomic.Loader=function(){var loadJson,parseStructure;return loadJson=function(path,callback){return $$.ajax({url:path,dataType:"json",error:function(){throw"Error loading app strcture json in "+path},success:function(appJson){var app,attr,value;appJson=JSON.parse(appJson.response),app={};for(attr in appJson)value=appJson[attr],"structure"!==attr&&(app[attr]=value);return app.structure=parseStructure(appJson.structure),console.log("Loaded "+path+" :: ",app),callback.call(callback,app)}})},parseStructure=function(components){var attributes,children,classes,component,instance,_i,_len;for(classes=[],_i=0,_len=components.length;_len>_i;_i++)component=components[_i],attributes=component.attributes||{},children=parseStructure(component.children||[]),App[component.type][component.name]?(instance=new App[component.type][component.name](attributes,children,component),classes.push(instance)):console.error("Atom."+component.type+"."+component.name+" not found");return classes},{loadJson:loadJson,parseStructure:parseStructure}}(),App={Atom:{},Molecule:{},Organism:{},Template:{},__Atomic:Atomic,__World:World,Cache:{structure:[]},init:function(json_path){return Atomic.Loader.loadJson(json_path,function(app){var body,component,_i,_len,_ref4;for(App.Cache.set(app.structure),body=$$(document.body),_ref4=app.structure,_i=0,_len=_ref4.length;_len>_i;_i++)component=_ref4[_i],component.render(body);return App.Router.init(app.startRoute)})}},App.Cache=function(){var addArticle,get,set,setArticle,_article,_articles,_asides,_cache,_cacheCommons;return _cache=null,_article=null,_articles={},_asides={},set=function(app){return _cache=app,_cacheCommons()},get=function(){return _cache},setArticle=function(instance){return _article=instance},addArticle=function(instance){return _articles[instance.attributes.id]=instance},_cacheCommons=function(){var component,_i,_j,_len,_len1,_results;for(_i=0,_len=_cache.length;_len>_i;_i++)component=_cache[_i],"Article"===component.constructor.type&&(_articles[component.attributes.id]=component);for(_results=[],_j=0,_len1=_cache.length;_len1>_j;_j++)component=_cache[_j],"Aside"===component.constructor.type&&_results.push(_asides[component.attributes.id]=component);return _results},{set:set,get:get,setArticle:setArticle,articles:function(){return _articles},article:function(){return _article},asides:function(){return _asides}}}(),App.Router=function(){var article,aside,back,init,section,_routes;return _routes=null,init=function(article_id){return _routes=[],article(article_id)},article=function(id,is_back){var instance;return null==is_back&&(is_back=!1),App.Template.Article._isAnimating()?void 0:(instance=App.Cache.articles()[id],instance.show(is_back),is_back?_routes.length--:_routes.push(id))},section=function(id){return App.Cache.article().section(id)},aside=function(){return App.Cache.article().toggleAside()},back=function(){var len;return len=_routes.length,1>=len?!1:article(_routes[len-2],!0)},{init:init,article:article,section:section,back:back,aside:aside}}(),App.Atom.Button=function(_super){function Button(attributes,children,options){Button.__super__.constructor.apply(this,arguments),(null!=options?options.router:void 0)&&this._checkRouter(options.router)}return __extends(Button,_super),Button.type="Button",Button.template='<button class="{{class}}">\n    <span class="icon {{icon}}"></span>\n    {{text}}\n</button>',Button.prototype._checkRouter=function(route){var parts;return parts=route.split(":"),this.el.bind("tap",function(){return App.Router[parts[0]](parts[1])})},Button}(Atomic.Atom),App.Atom.Input=function(_super){function Input(){return _ref4=Input.__super__.constructor.apply(this,arguments)}return __extends(Input,_super),Input.type="Input",Input.template='<input type="{{type}}" placeholder="{{placeholder}}" class="{{class}}" name="{{name}}" />',Input.prototype.value=function(){return this.el.val()},Input}(Atomic.Atom),App.Atom.Label=function(_super){function Label(){return _ref5=Label.__super__.constructor.apply(this,arguments)}return __extends(Label,_super),Label.type="Label",Label.template='<label class="{{class}}">{{text}}</label>',Label}(Atomic.Atom),App.Atom.Li=function(_super){function Li(){return _ref6=Li.__super__.constructor.apply(this,arguments)}return __extends(Li,_super),Li.type="Li",Li.template="<li>{{text}}</li>",Li}(Atomic.Atom),App.Atom.Select=function(_super){function Select(){Select.__super__.constructor.apply(this,arguments),this.attributes.value&&this.el.val(attributes.value)}return __extends(Select,_super),Select.type="Select",Select.template='<select name="{{name}}" class="{{class}}" id="{{id}}">\n    {{#options}}\n        <option value="{{value}}">{{label}}</option>\n    {{/options}}\n</select>',Select.prototype.value=function(){return this.el.val()},Select}(Atomic.Atom),App.Atom.Textarea=function(_super){function Textarea(){return _ref7=Textarea.__super__.constructor.apply(this,arguments)}return __extends(Textarea,_super),Textarea.type="Textarea",Textarea.template='<textarea class="{{class}}"></textarea>',Textarea.prototype.value=function(){return this.el.val()},Textarea}(Atomic.Atom),App.Atom.Title=function(_super){function Title(){Title.__super__.constructor.apply(this,arguments)}return __extends(Title,_super),Title.type="Title",Title.template='<h{{size}} class="{{class}}">{{text}}</h{{size}}>',Title}(Atomic.Atom),App.Molecule.Footer=function(_super){function Footer(){return _ref8=Footer.__super__.constructor.apply(this,arguments)}return __extends(Footer,_super),Footer.type="Footer",Footer.template='<footer>\n    <nav data-children-container="navigation"></nav>\n</footer>',Footer}(Atomic.Molecule),App.Molecule.Form=function(_super){function Form(){var submit_attributes,_this=this;Form.__super__.constructor.apply(this,arguments),submit_attributes={text:"Submit","class":"big fluid accept"},this.submit=new App.Atom.Button(submit_attributes),this.appendChilds([this.submit]),this.submit.el.bind("tap",function(){return console.log(_this.value())})}return __extends(Form,_super),Form.type="Form",Form.template='<form class="{{class}}" id="{{id}}" onsubmit="return false;">\n  <h1>{{title}}</h1>\n</form>',Form.prototype.onSubmit=function(callback){var _this=this;return this.submit.el.bind("tap",function(){return callback.call(_this,_this.value())})},Form.prototype.value=function(){var child,values,_i,_len,_ref9;for(values={},_ref9=this.children,_i=0,_len=_ref9.length;_len>_i;_i++)child=_ref9[_i],null!=child.value&&(values[child.attributes.name]=child.value());return values},Form}(Atomic.Molecule),App.Molecule.Header=function(_super){function Header(){return _ref9=Header.__super__.constructor.apply(this,arguments)}return __extends(Header,_super),Header.type="Header",Header.template='<header>\n    <h1>{{title}}</h1>\n    <nav class="left" data-children-container="left"></nav>\n    <nav class="right" data-children-container="right"></nav>\n</header>',Header.prototype.render=function(){var button,buttons,_i,_len,_results;for(Header.__super__.render.apply(this,arguments),buttons=this.children.filter(function(item){return"Button"===item.namespace}),_results=[],_i=0,_len=buttons.length;_len>_i;_i++)button=buttons[_i],button.visibleOnSection&&button.el.attr("data-show-section",button.visibleOnSection),button.hiddenOnSection?_results.push(button.el.attr("data-hide-section",button.hiddenOnSection)):_results.push(void 0);return _results},Header}(Atomic.Molecule),App.Molecule.List=function(_super){function List(){return _ref10=List.__super__.constructor.apply(this,arguments)}return __extends(List,_super),List.type="List",List.template='<ul class="{{class}}"></ul>',List}(Atomic.Molecule),App.Molecule.Nav=function(_super){function Nav(){return _ref11=Nav.__super__.constructor.apply(this,arguments)}return __extends(Nav,_super),Nav.type="Nav",Nav.template='<nav class="{{class}}"></nav>',Nav}(Atomic.Molecule),App.Organism.Aside=function(_super){function Aside(){return _ref12=Aside.__super__.constructor.apply(this,arguments)}return __extends(Aside,_super),Aside.type="Aside",Aside.template='<aside class="{{class}}" id="{{id}}"></aside>',Aside.prototype.activate=function(){return this.el.addClass("active")},Aside.prototype.deactivate=function(){return this.el.removeClass("active")},Aside}(Atomic.Organism),App.Organism.Section=function(_super){function Section(){return _ref13=Section.__super__.constructor.apply(this,arguments)}return __extends(Section,_super),Section.type="Section",Section.template='<section id="{{id}}" class="{{class}}"></section>',Section}(Atomic.Organism),App.Template.Article=function(_super){function Article(attributes,children,options){this._show=__bind(this._show,this),Article.__super__.constructor.apply(this,arguments),options&&(this.animation=options.animation,this.aside=options.aside)}return __extends(Article,_super),Article.autorender=!1,Article.type="Article",Article.template='<article id="{{id}}" class="{{class}}"></article>',Article._animations_in_progress=0,Article._startRouterAnimation=function(element,animation,direction){return element.addClass("active").attr("data-animation",animation),element.attr("data-direction",direction)},Article._onAnimationEnd=function(ev){var article,el,_ref14;return null==ev&&(ev=event),el=$$(ev.target),el.unbind("webkitAnimationEnd",Article._onAnimationEnd),"out"===(_ref14=el.attr("data-direction"))||"back-out"===_ref14?el.removeClass("active"):(article=App.Cache.articles()[el.attr("id")],article.aside&&App.Cache.asides()[article.aside].el.addClass("active")),el.removeAttr("data-direction").removeAttr("data-animation"),setTimeout(function(){return Article._animations_in_progress--},50)},Article._isAnimating=function(){return Article._animations_in_progress>0},Article._swiped_px=0,Article._aside_open=!1,Article._aside_transforming=!1,Article._bindToSwipe=function(article){return article.bind("swipingHorizontal",Article._onSwiping),article.bind("touchend",Article._onSwipingEnd)},Article._onTransitionEnd=function(ev){var target;return null==ev&&(ev=event),target=$$(ev.target).closest("article"),target.unbind("webkitTransitionEnd",Article._onTransitionEnd),target.hasClass("aside")&&!target.attr("data-aside")&&target.removeClass("aside"),Article._aside_transforming=!1},Article._onSwiping=function(ev){var article,delta;return null==ev&&(ev=event),delta=ev.quoData.delta.x,delta>=0?(Article._swiped_px=delta,ev.originalEvent.preventDefault(),article=$$(ev.target).closest("article"),article.style("webkitTransform","translateX("+delta+"px)")):Article._swiped_px=0},Article._onSwipingEnd=function(ev){var article;return null==ev&&(ev=event),article=$$(ev.target).closest("article"),!Article._aside_open&&Article._swiped_px>100||Article._aside_open?App.Cache.article().toggleAside():Article._swiped_px>0&&(article.bind("webkitTransitionEnd",Article._onTransitionEnd),article.addClass("aside")),article.removeAttr("style"),Article._swiped_px=0},Article.prototype.show=function(is_back){var _this=this;return null==is_back&&(is_back=!1),this.el&&0!==this.el.length?this._show(is_back):(this.render(this.container,!0),this.aside&&this.constructor._bindToSwipe(this.el),setTimeout(function(){return _this._show(is_back)}))},Article.prototype._show=function(is_back){var current;return current=App.Cache.article(),App.Cache.setArticle(this),this.el.addClass("active"),this.aside&&App.Cache.asides()[this.aside].deactivate(),(null!=current?current.aside:void 0)&&App.Cache.asides()[current.aside].deactivate(),current?(this.constructor._animations_in_progress+=2,current.el.bind("webkitAnimationEnd",this.constructor._onAnimationEnd),this.el.bind("webkitAnimationEnd",this.constructor._onAnimationEnd),is_back?(this.constructor._startRouterAnimation(this.el,current.animation,"back-in"),this.constructor._startRouterAnimation(current.el,current.animation,"back-out")):(this.constructor._startRouterAnimation(this.el,this.animation,"in"),this.constructor._startRouterAnimation(current.el,this.animation,"out"))):(this.aside&&App.Cache.asides()[this.aside].activate(),void 0)},Article.prototype.section=function(id){var sections;return sections=this.el.children("section"),sections.removeClass("active").filter("#"+id).addClass("active"),this.constructor._aside_open?this.toggleAside():void 0},Article.prototype.toggleAside=function(){return this.constructor._aside_transforming===!0?!1:(this.constructor._aside_transforming=!0,App.Cache.asides()[this.aside].el.addClass("active"),this.el.bind("webkitTransitionEnd",this.constructor._onTransitionEnd),this.el.attr("data-aside")?(this.constructor._aside_open=!1,this.el.addClass("aside").removeAttr("data-aside")):(this.constructor._aside_open=!0,this.el.addClass("aside").attr("data-aside","show")))},Article}.call(this,Atomic.Template),this.App=App}).call(this);